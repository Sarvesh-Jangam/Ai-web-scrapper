<!DOCTYPE html>
<html>
<head>
    <title>Find Mitigation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #f8f9fa; }
        .result-box {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
            font-size: 16px;
            line-height: 1.6;
        }
        .result-box h5 {
            font-weight: 600;
            color: #0d6efd;
            margin-bottom: 8px;
        }
        .result-section { margin-bottom: 15px; }
        ul { padding-left: 20px; }
    </style>
</head>
<body class="container p-4">

    <h2 class="mb-3">üîí Mitigation Finder</h2>
    <p>Enter a CVE ID or vulnerability description:</p>

    <div class="input-group mb-3">
        <input id="query" class="form-control" placeholder="e.g., CVE-2025-1234 or 'Apache buffer overflow'">
        <button class="btn btn-primary" onclick="findMitigation()">Find Mitigation</button>
    </div>

    <div id="result" class="result-box" style="display:none;"></div>

    <script>
        async function findMitigation() {
            const query = document.getElementById("query").value;
            const resultBox = document.getElementById("result");

            resultBox.style.display = "block";
            resultBox.innerHTML = "<em>‚è≥ Searching for mitigation...</em>";

            const res = await fetch("/api/mitigation", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ query })
            });

            const data = await res.json();

            if (data.error) {
                resultBox.innerHTML = "<strong>‚ùå Error:</strong> " + data.error;
                return;
            }

            // ‚úÖ Build formatted HTML from JSON
            let html = "";

            if (data.vulnerability) {
                html += `<div class="result-section"><h5>Vulnerability</h5><p>${data.vulnerability}</p></div>`;
            }
            if (data.summary) {
                html += `<div class="result-section"><h5>Summary</h5><p>${data.summary}</p></div>`;
            }
            if (data.mitigation) {
                html += `<div class="result-section"><h5>Mitigation</h5><p>${data.mitigation}</p></div>`;
            }
            if (data.references && data.references.length > 0) {
                html += `<div class="result-section"><h5>References</h5><ul>`;
                data.references.forEach(ref => {
                    html += `<li><a href="${ref}" target="_blank">${ref}</a></li>`;
                });
                html += `</ul></div>`;
            }

            resultBox.innerHTML = html || "<p>No structured mitigation details found.</p>";
        }
    </script>
</body>
</html>
